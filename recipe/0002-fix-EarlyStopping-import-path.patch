From 769f4afdc770ad82d2f515433644c1e2e92b25ee Mon Sep 17 00:00:00 2001
From: Andrii Osipov <aosipov@anaconda.com>
Date: Thu, 6 Feb 2025 12:44:10 -0800
Subject: [PATCH] fix EarlyStopping import path

---
 smote_variants/oversampling/_deago.py | 27 ++++++++++++++++++---------
 1 file changed, 18 insertions(+), 9 deletions(-)

diff --git a/smote_variants/oversampling/_deago.py b/smote_variants/oversampling/_deago.py
index 08a8e8c..a95a31e 100755
--- a/smote_variants/oversampling/_deago.py
+++ b/smote_variants/oversampling/_deago.py
@@ -129,9 +129,7 @@ class DEAGO(OverSampling):
                                   'sigma': [0.05, 0.1, 0.2]}
         return cls.generate_parameter_combinations(parameter_combinations, raw)
 
-    def get_model(self,
-                    n_dim,
-                    encoding_d):
+    def get_model(self, n_dim, encoding_d=None):
         """
         Return the model
 
@@ -142,13 +140,24 @@ class DEAGO(OverSampling):
         Returns:
             tensorflow.keras.models.Model, list: the model and the callbacks
         """
-        # this import is here to prevent the heavy importing of tensorflow when not needed
-        from tensorflow.keras.layers import Input, Dense, GaussianNoise # pylint: disable=wrong-import-position,no-name-in-module,import-outside-toplevel
-        from tensorflow.keras.models import Model # pylint: disable=wrong-import-position,no-name-in-module,import-outside-toplevel
-        from tensorflow.keras.callbacks import EarlyStopping # pylint: disable=wrong-import-position,no-name-in-module,import-outside-toplevel
+        # Ensure encoder_params exists
+        if not hasattr(self, 'encoder_params'):
+            self.encoder_params = {'sigma': 0.1}  # Default sigma
+
+        # Validate input values
+        assert isinstance(n_dim, int) and n_dim > 0, "n_dim must be a positive integer"
+
+        # Fix: Ensure encoding_d is set correctly
+        if encoding_d is None or not isinstance(encoding_d, int) or encoding_d <= 0:
+            encoding_d = max(1, n_dim // 2)  # Default encoding size
+
+        # Importing TensorFlow Keras to avoid issues
+        from tensorflow import keras
+        from tensorflow.keras.layers import Input, Dense, GaussianNoise
+        from tensorflow.keras.models import Model
 
-        # constructing the autoencoder
-        callbacks = [EarlyStopping(monitor='val_loss', patience=2)]
+        # Constructing the autoencoder
+        callbacks = [keras.callbacks.EarlyStopping(monitor='val_loss', patience=2)]
 
         input_layer = Input(shape=(n_dim,))
         noise = GaussianNoise(self.encoder_params['sigma'])(input_layer)
-- 
2.39.3 (Apple Git-146)

